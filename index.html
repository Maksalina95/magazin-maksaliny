<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ú–∞–≥–∞–∑–∏–Ω –ú–∞–∫—Å–∞–ª–∏–Ω—ã</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
</head>
<body>
  <div class="container">
    <aside>
      <h2>–ú–µ–Ω—é</h2>
      <a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="category.html">üóÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
      <a href="favorites.html">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
      <a href="delivery.html">üöö –î–æ—Å—Ç–∞–≤–∫–∞</a>
      <a href="contacts.html">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
      <a href="address.html">üìç –ê–¥—Ä–µ—Å</a>
      <a href="terms.html">üìú –ü—Ä–∞–≤–∏–ª–∞</a>
    </aside>

    <main>
      <!-- üéû –°–ª–∞–π–¥–µ—Ä -->
      <div class="slider-container">
        <img src="images/reklama1.jpg" class="slide active" alt="–†–µ–∫–ª–∞–º–∞ 1" />
        <img src="images/reklama2.jpg" class="slide" alt="–†–µ–∫–ª–∞–º–∞ 2" />
      </div>
      <div class="dots">
        <span class="dot active" onclick="showSlide(0)"></span>
        <span class="dot" onclick="showSlide(1)"></span>
      </div>

      <!-- üîç –ü–æ–∏—Å–∫ -->
      <div class="filters">
        <input
          type="text"
          id="searchInput"
          placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
          list="autocompleteList"
          autocomplete="off"
        />
        <datalist id="autocompleteList"></datalist>
      </div>

      <!-- üéØ –§–∏–ª—å—Ç—Ä—ã -->
      <div class="filters" id="filters">
        <label for="filter-category">üóÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
        <select id="filter-category"><option value="">–í—Å–µ</option></select>

        <label for="filter-subcategory">üìÅ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
        <select id="filter-subcategory"><option value="">–í—Å–µ</option></select>

        <label for="filter-section">üì¶ –†–∞–∑–¥–µ–ª:</label>
        <select id="filter-section"><option value="">–í—Å–µ</option></select>

        <label for="filter-brand">üè∑ –ë—Ä–µ–Ω–¥:</label>
        <select id="filter-brand"><option value="">–í—Å–µ</option></select>

        <label for="filter-country">üåç –°—Ç—Ä–∞–Ω–∞:</label>
        <select id="filter-country"><option value="">–í—Å–µ</option></select>

        <label for="filter-type">üõ† –¢–∏–ø:</label>
        <select id="filter-type"><option value="">–í—Å–µ</option></select>

        <div class="price-range">
          <label for="filter-price-min">üí∞ –æ—Ç:</label>
          <input type="number" id="filter-price-min" placeholder="0" min="0" />
          <label for="filter-price-max">–¥–æ:</label>
          <input type="number" id="filter-price-max" placeholder="100000" min="0" />
        </div>
      </div>

      <!-- üõç –ö–∞—Ç–∞–ª–æ–≥ -->
      <h2>–í—Å–µ —Ç–æ–≤–∞—Ä—ã</h2>
      <div id="product-list">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>

      <!-- ‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ (–ø—É—Å—Ç–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤) -->
      <section class="reviews-section" id="reviews-section">
        <h2>–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
        <!-- –ó–¥–µ—Å—å —Ç—ã –ø–æ—Ç–æ–º –±—É–¥–µ—à—å –¥–æ–±–∞–≤–ª—è—Ç—å –æ—Ç–∑—ã–≤—ã -->
      </section>

      <!-- üîÑ –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
      <button id="refreshBtn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–∞–π—Ç</button>
    </main>
  </div>

  <!-- üìú –°–∫—Ä–∏–ø—Ç—ã -->
  <script src="filterSearch.js"></script>
  <script src="favorites.js"></script>
  <script src="service-worker.js"></script>

  <script>
    // üéû –°–ª–∞–π–¥–µ—Ä
    let slides = document.querySelectorAll(".slide");
    let dots = document.querySelectorAll(".dot");
    let currentSlide = 0;

    function showSlide(index) {
      slides[currentSlide].classList.remove("active");
      dots[currentSlide].classList.remove("active");
      currentSlide = index;
      slides[currentSlide].classList.add("active");
      dots[currentSlide].classList.add("active");
    }

    setInterval(() => {
      let next = (currentSlide + 1) % slides.length;
      showSlide(next);
    }, 5000);

    // üîÅ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.getElementById("refreshBtn").onclick = () => location.reload();
  </script>

  <!-- ==== –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã, —Å –≤–∏–¥–µ–æ –∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–º ==== -->
  <script>
    const sheetId = '1gBcuPzWv_nH2i7sWyCaERVCjO-hLg8EcndPkEMlNqgw';
    const url = https://opensheet.elk.sh/${sheetId}/Sheet1;
    const productList = document.getElementById('product-list');

    // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–∑ localStorage
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –∏–∑–±—Ä–∞–Ω –ª–∏ —Ç–æ–≤–∞—Ä
    function isFavorite(id) {
      return favorites.includes(id);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –≤ localStorage
    function toggleFavorite(id) {
      if (isFavorite(id)) {
        favorites = favorites.filter(favId => favId !== id);
      } else {
        favorites.push(id);
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      renderProducts(currentProducts);
    }

    // –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    let currentProducts = [];

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    fetch(url)
      .then(res => res.json())
      .then(data => {
        // –§–∏–ª—å—Ç—Ä—É–µ–º: —É —Ç–æ–≤–∞—Ä–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ñ–æ—Ç–æ, –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω–∞
        currentProducts = data.filter(item => item.—Ñ–æ—Ç–æ && item.–Ω–∞–∑–≤–∞–Ω–∏–µ && item.—Ü–µ–Ω–∞);
        renderProducts(currentProducts);
        populateFilters(currentProducts);
        populateAutocomplete(currentProducts);
      })
      .catch(err => {
        productList.innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤.</p>';
        console.error(err);
      });

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
    function renderProducts(products) {
      productList.innerHTML = '';
      if (products.length === 0) {
        productList.innerHTML = '<p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>';
        return;
      }
      products.forEach(item => {
        const isFav = isFavorite(item.ID || item.id || item.–Ω–∞–∑–≤–∞–Ω–∏–µ); // –µ—Å–ª–∏ –Ω–µ—Ç ID, –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
        const productEl = document.createElement('div');
        productEl.innerHTML = `
          <img src="${item.—Ñ–æ—Ç–æ}" alt="${item.–Ω–∞–∑–≤–∞–Ω–∏–µ}" />
          <h3>${item.–Ω–∞–∑–≤–∞–Ω–∏–µ}</h3>
          <p>${item.–æ–ø–∏—Å–∞–Ω–∏–µ || ''}</p>
          ${item.–≤–∏–¥–µ–æ ? <video class="product-video" controls src="${item.–≤–∏–¥–µ–æ}"></video> : ''}
          <strong>${item.—Ü–µ–Ω–∞} ‚ÇΩ</strong><br/>
          <a href="https://wa.me/79376280080" target="_blank" rel="noopener noreferrer">WhatsApp</a>
          <button class="favorite-btn ${isFav ? 'active' : ''}" aria-label="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">‚≠ê</button>
        `;
        productList.appendChild(productEl);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
        const favBtn = productEl.querySelector('.favorite-btn');
        favBtn.addEventListener('click', () => toggleFavorite(item.ID || item.id || item.–Ω–∞–∑–≤–∞–Ω–∏–µ));
      });
    }

    // –§–∏–ª—å—Ç—Ä—ã: –∑–∞–ø–æ–ª–Ω–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –æ—Å—Ç–∞–ª—å–Ω–æ–µ
    function populateFilters(products) {
      const categories = new Set();
      const subcategories = new Set();
      const sections = new Set();
      const brands = new Set();
      const countries = new Set();
      const types = new Set();

      products.forEach(item => {
        if (item.–∫–∞—Ç–µ–≥–æ—Ä–∏—è) categories.add(item.–∫–∞—Ç–µ–≥–æ—Ä–∏—è);
        if (item.–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è) subcategories.add(item.–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è);
        if (item.—Ä–∞–∑–¥–µ–ª) sections.add(item.—Ä–∞–∑–¥–µ–ª);
        if (item.–±—Ä–µ–Ω–¥) brands.add(item.–±—Ä–µ–Ω–¥);
        if (item.—Å—Ç—Ä–∞–Ω–∞) countries.add(item.—Å—Ç—Ä–∞–Ω–∞);
        if (item.—Ç–∏–ø) types.add(item.—Ç–∏–ø);
      });

      fillSelect('filter-category', categories);
      fillSelect('filter-subcategory', subcategories);
      fillSelect('filter-section', sections);
      fillSelect('filter-brand', brands);
      fillSelect('filter-country', countries);
      fillSelect('filter-type', types);
    }

    // –ü–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è select
    function fillSelect(id, items) {
      const select = document.getElementById(id);
      select.innerHTML = '<option value="">–í—Å–µ</option>';
      Array.from(items).sort().forEach(value => {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = value;
        select.appendChild(option);
      });
    }

    // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
    function populateAutocomplete(products) {
      const datalist = document.getElementById('autocompleteList');
      datalist.innerHTML = '';
      products.forEach(item => {
        if (item.–Ω–∞–∑–≤–∞–Ω–∏–µ) {
          const option = document.createElement('option');
          option.value = item.–Ω–∞–∑–≤–∞–Ω–∏–µ;
          datalist.appendChild(option);
        }
      });
    }

    // –†–µ–∞–∫—Ü–∏—è –Ω–∞ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫
    const filterInputs = [
      'searchInput',
      'filter-category',
      'filter-subcategory',
      'filter-section',
      'filter-brand',
      'filter-country',
      'filter-type',
      'filter-price-min',
      'filter-price-max'
    ].map(id => document.getElementById(id));

    filterInputs.forEach(input => {
      input.addEventListener('input', () => {
        let filtered = currentProducts;

        // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
        const searchText = document.getElementById('searchInput').value.trim().toLowerCase();
        if (searchText) {
          filtered = filtered.filter(item => item.–Ω–∞–∑–≤–∞–Ω–∏–µ.toLowerCase().includes(searchText));
        }

        // –§–∏–ª—å—Ç—Ä—ã –ø–æ select
        const cat = document.getElementById('filter-category').value;
        if (cat) filtered = filtered.filter(item => item.–∫–∞—Ç–µ–≥–æ—Ä–∏—è === cat);

        const subcat = document.getElementById('filter-subcategory').value;
        if (subcat) filtered = filtered.filter(item => item.–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è === subcat);

        const section = document.getElementById('filter-section').value;
        if (section) filtered = filtered.filter(item => item.—Ä–∞–∑–¥–µ–ª === section);

        const brand = document.getElementById('filter-brand').value;
        if (brand) filtered = filtered.filter(item => item.–±—Ä–µ–Ω–¥ === brand);

        const country = document.getElementById('filter-country').value;
        if (country) filtered = filtered.filter(item => item.—Å—Ç—Ä–∞–Ω–∞ === country);

        const type = document.getElementById('filter-type').value;
        if (type) filtered = filtered.filter(item => item.—Ç–∏–ø === type);

        // –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ
        const priceMin = Number(document.getElementById('filter-price-min').value);
        const priceMax = Number(document.getElementById('filter-price-max').value);

        if (!isNaN(priceMin)) {
          filtered = filtered.filter(item => Number(item.—Ü–µ–Ω–∞) >= priceMin);
        }
        if (!isNaN(priceMax) && priceMax > 0) {
          filtered = filtered.filter(item => Number(item.—Ü–µ–Ω–∞) <= priceMax);
        }

        renderProducts(filtered);
      });
    });
  </script>
</body>
</html>
